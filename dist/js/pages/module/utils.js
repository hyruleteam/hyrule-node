define(["apiURL","template"],function(n,o){var r=n.baseUrl,a=r+"",i=r+"api/h5/fileupload",s=o.defaults.rules[1];s.test=new RegExp(s.test.source.replace("{{","<\\?").replace("}}","\\?>")),o.defaults.imports.delHtmlTag=function(e){return null!==e?e.replace(/<[^>]+>/g,""):e};var l={};return l.supportStorage=function(){return"object"==typeof window.localStorage},l.randomNumber=function(){return randomFromInterval(1,1e6)},l.randomFromInterval=function(){return Math.floor(Math.random()*(t-e+1)+e)},l.parseJson=function(e){if(e&&e.length>0&&"string"==typeof e)return JSON.parse(e)},l.stringJson=function(e){if(e&&"object"==typeof e)return JSON.stringify(e)},l.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?decodeURIComponent(n[2]):null},l.cloneObj=function(e){var t,n=e.constructor===Array?[]:{};if("object"==typeof e){if(window.JSON)t=decoration.base.stringJson(e),n=decoration.base.parseJson(t);else for(var o in e)n[o]="object"==typeof e[o]?cloneObj(e[o]):e[o];return n}},l.sendAjax=function(e,t,n,o){var r=a+e.opeType;$.ajax({url:r,type:"post",async:void 0==o?"true":o,data:e.data,success:function(e){var o=e.code||e.return_code||"",r=e.msg||"无返回信息";if(0===o)t(e);else{if(o===-1)return window.location.href="/login?returnUrl="+window.location.href,!1;if($.toast(r),void 0===n)return;n(e)}},error:function(t,n,o){$.toast("发送请求失败！"),console.warn("%c调用接口"+e.opeType+"出错","color:red;font-size:36px;"),console.log("XMLHttpRequest 对象:"+t),console.log("错误信息:"+n),console.log("捕获的异常对象"+o)}})},l.singleFileUpload=function(e){$(".loading").removeClass("hide");var t=512e3;if(e[0].files.length){var n=Array.prototype.slice.call(e[0].files);if(n.length>1)return void alert("最多只能选择1张图片");var o={},r=null,a=e.val(),s=a.lastIndexOf("."),c=a.substr(s);if(".jpg"!=c&&".jpeg"!=c&&".JPG"!=c&&".JPEG"!=c&&".PNG"!=c&&".png"!=c)return $.toast("只能选择jpg/gif/png格式的图片"),void e.show();if(r=document.createElement("img"),r.src=a,r.fileSize>t)return $.toast("图片尺寸请不要大于500KB"),void e.show();var u=new FormData;return u.append("file",e[0].files[0]),$.ajax({type:"post",url:i,async:!1,contentType:!1,processData:!1,data:u,dataType:"text",success:function(e){var t=l.parseJson(e);o=t}}),console.log(o),o}},l.isType=function(e){return function(t){return Object.prototype.toString.call(t)==="[object "+e+"]"}},l.renderList=function(e,t,n){var r=o(t,e);$(n).html(r)},l.renderListHTML=function(e,t,n){o.config("escape",!1);var r=o(t,e);$(n).html(r)},l.renderMoreList=function(e,t,n){var r=o(t,e);$(n).append(r)},l.renderMoreListHTML=function(e,t,n){o.config("escape",!1);var r=o(t,e);$(n).append(r)},l.loadMore=function(e){var t=$(e).text();$(e).text("加载中..."),setTimeout(function(){$(e).text(t)},1e3)},l.pageInit=function(e){$(document).on("pageInit",function(t,n,o){console.log(n),e(t,n,o)})},l.loadingOff=function(){$(".content").removeClass("loader-ovh"),$(".m-loading").hide()},l.scrollLoad=function(e){var t=0,n=0,o=$(".content").height();$(".content").off("scroll").on("scroll",function(){t=$(this)[0].scrollHeight,n=$(this)[0].scrollTop,n+o>=t&&e()})},l.btnLoading=function(e,t){t=void 0==t?"加载中...":t,$(e).val(t),$(e).text(t),$(e).attr("disabled",!0),$(e).addClass("f-disabled")},l.btnLoadingOff=function(e,t){$(e).val(t),$(e).text(t),$(e).removeAttr("disabled"),$(e).removeClass("f-disabled")},l.isWechat=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)},l.auth={},l.auth.getUserInfo=function(){var e=l.parseJson(localStorage.getItem("user")),t=localStorage.getItem("token");return e&&t?{user:e,token:t}:void(window.location.href="/login?returnUrl="+window.location.href)},l});